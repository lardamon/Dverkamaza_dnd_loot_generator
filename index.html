<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –õ—É—Ç–∞ D&D 5e –æ—Ç –î–≤–µ—Ä—å–ö–∞–º–∞–∑–∞</title>

  <link rel="manifest" href="manifest.json" />
  <!-- –í–ê–ñ–ù–û: –≤–µ—Ä—Å–∏—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å VERSION –≤ service-worker.js -->
  <link rel="stylesheet" href="styles.css?v=v2025-09-05-1" />

  <meta name="description" content="–û—Ñ–ª–∞–π–Ω PWA –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ª—É—Ç–∞ D&D 5e –Ω–∞ —Ä—É—Å—Å–∫–æ–º. –í–∞–Ω–∏–ª—å–Ω—ã–π HTML/CSS/JS, JSON-—Ç–∞–±–ª–∏—Ü—ã, –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –∏—Å—Ç–æ—Ä–∏—è." />
</head>
<body>
  <header class="app-header">
    <button id="menuBtn" class="btn icon" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é" title="–ú–µ–Ω—é">‚ò∞</button>
    <div class="brand">
      <span class="logo">üé≤</span>
      <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –õ—É—Ç–∞ D&D 5e –æ—Ç –î–≤–µ—Ä—å–ö–∞–º–∞–∑–∞</h1>
    </div>
  </header>

  <main class="container">
    <!-- –ü–ê–ù–ï–õ–¨ –í–í–û–î–ê -->
    <section class="card">
      <div class="row wrap gap">
        <div class="tabs" role="tablist" aria-label="–†–µ–∂–∏–º">
          <button class="tab active" role="tab" aria-selected="true" data-tab="mode-battle">–ë–æ–π</button>
          <button class="tab" role="tab" aria-selected="false" data-tab="mode-env">–û–∫—Ä—É–∂–µ–Ω–∏–µ</button>
          <button class="tab" role="tab" aria-selected="false" data-tab="mode-music">–ú—É–∑—ã–∫–∞</button>
        </div>
      </div>

      <!-- –†–µ–∂–∏–º: –ë–æ–π -->
      <div id="mode-battle" class="mode visible">
        <div class="row wrap gap">
          <!-- desktop: number, mobile: select -->
          <div class="field">
            <label for="crInput" class="desktop-only">CR –º–æ–Ω—Å—Ç—Ä–∞</label>
            <input id="crInput" class="desktop-only" type="number" inputmode="numeric" min="0" max="30" value="1" />
            <label for="crSelect" class="mobile-only">CR –º–æ–Ω—Å—Ç—Ä–∞</label>
            <select id="crSelect" class="mobile-only"></select>
          </div>

          <div class="field">
            <label for="d20Input" class="desktop-only">–†–µ–∑—É–ª—å—Ç–∞—Ç d20</label>
            <input id="d20Input" class="desktop-only" type="number" inputmode="numeric" min="1" max="20" placeholder="1‚Äì20" />
            <label for="d20Select" class="mobile-only">–†–µ–∑—É–ª—å—Ç–∞—Ç d20</label>
            <select id="d20Select" class="mobile-only"></select>
          </div>

          <label class="checkbox one-line">
            <input id="bossCheck" type="checkbox" />
            <span>–ë–æ—Å—Å (—É–≤–µ–ª–∏—á–∏—Ç—å –±—é–¥–∂–µ—Ç)</span>
          </label>
        </div>
      </div>

      <!-- –†–µ–∂–∏–º: –û–∫—Ä—É–∂–µ–Ω–∏–µ -->
      <div id="mode-env" class="mode">
        <div class="row wrap gap">
          <div class="field">
            <label for="containerSelect">–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä</label>
            <select id="containerSelect">
              <option value="small">–ú–∞–ª—ã–π</option>
              <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
              <option value="large">–ö—Ä—É–ø–Ω—ã–π</option>
            </select>
          </div>
          <div class="field">
            <label for="tierSelect">Tier</label>
            <select id="tierSelect"></select>
          </div>

          <div class="field">
            <label for="d20InputEnv" class="desktop-only">–†–µ–∑—É–ª—å—Ç–∞—Ç d20</label>
            <input id="d20InputEnv" class="desktop-only" type="number" inputmode="numeric" min="1" max="20" placeholder="1‚Äì20" />
            <label for="d20SelectEnv" class="mobile-only">–†–µ–∑—É–ª—å—Ç–∞—Ç d20</label>
            <select id="d20SelectEnv" class="mobile-only"></select>
          </div>
        </div>
      </div>

      <!-- –†–µ–∂–∏–º: –ú—É–∑—ã–∫–∞ (–∫–∞–∫ –±—ã–ª–æ) -->
      <div id="mode-music" class="mode">
        <div class="row wrap gap">
          <div class="field">
            <label for="musicCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="musicCategory"></select>
          </div>
          <div class="field grow">
            <label>–ü–ª–µ–π–ª–∏—Å—Ç</label>
            <ul id="trackList" class="tracks scroll"></ul>
          </div>
        </div>

        <div class="music-controls mt">
          <div class="row gap">
            <button id="prevBtn" class="btn icon" title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π">‚èÆ</button>
            <button id="playBtn" class="btn icon" title="–ü—É—Å–∫/–ü–∞—É–∑–∞">‚èØ</button>
            <button id="nextBtn" class="btn icon" title="–°–ª–µ–¥—É—é—â–∏–π">‚è≠</button>
            <button id="shuffleBtn" class="btn" title="–®–∞—Ñ—Ñ–ª">üîÄ</button>
            <button id="loopBtn" class="btn" title="–ü–æ–≤—Ç–æ—Ä">üîÅ</button>
            <div class="row gap" style="align-items:center">
              <span class="hint">–ì—Ä–æ–º–∫–æ—Å—Ç—å</span>
              <input id="volumeRange" type="range" min="0" max="1" step="0.01" value="0.8" />
            </div>
          </div>
          <div class="mt">
            <strong id="nowPlaying">–ù–∏—á–µ–≥–æ –Ω–µ –∏–≥—Ä–∞–µ—Ç</strong>
          </div>
        </div>

        <audio id="audio" preload="none"></audio>
      </div>

      <div class="row wrap gap mt">
        <button id="generateBtn" class="btn primary">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ª—É—Ç</button>
        <button id="copyBtn" class="btn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="saveHistoryBtn" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é</button>
      </div>
    </section>

    <!-- –†–ï–ó–£–õ–¨–¢–ê–¢ -->
    <section id="resultCard" class="card">
      <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>

      <div class="grid cols-2 mt">
        <div>
          <h3>–ú–æ–Ω–µ—Ç—ã</h3>
          <ul id="coinsList"></ul>
        </div>
        <div>
          <h3>–ü—Ä–µ–¥–º–µ—Ç—ã</h3>
          <ul id="itemsList"></ul>
        </div>
      </div>

      <div class="grid cols-2 mt">
        <div>
          <h3>–ú–µ–ª–∫–∏–µ –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏</h3>
          <ul id="smallGemsList"></ul>
        </div>
        <div>
          <h3>–†–µ–¥–∫–∏–µ –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏</h3>
          <ul id="rareGemsList"></ul>
        </div>
      </div>
      <div class="mt">
        <strong>–ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å (gp): </strong><span id="totalValue"></span>
      </div>
    </section>

    <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ PWA: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª -->
    <section id="installCard" class="card subtle" hidden>
      <div class="row wrap gap">
        <div><h2>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h2></div>
        <div class="spacer"></div>
        <button id="installBtn" class="btn" hidden>–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω</button>
      </div>
      <p id="installHint" class="hint" hidden>
        –ù–∞ iPhone: –æ—Ç–∫—Ä–æ–π—Ç–µ –º–µ–Ω—é ¬´–ü–æ–¥–µ–ª–∏—Ç—å—Å—è¬ª ‚Üí ¬´–ù–∞ —ç–∫—Ä–∞–Ω ‚Äú–î–æ–º–æ–π‚Äù¬ª.
      </p>
    </section>
  </main>

  <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
  <aside id="sidePanel" class="sidepanel left">
    <div class="side-header">
      <h2>–ú–µ–Ω—é</h2>
      <button id="closeMenuBtn" class="btn icon" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
    </div>
    <div class="side-tabs">
      <button class="stab active" data-panel="historyPanel">–ò—Å—Ç–æ—Ä–∏—è</button>
      <button class="stab" data-panel="settingsPanel">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —É–±—Ä–∞–Ω–∞ -->
    </div>

    <div class="side-content">
      <!-- –ò—Å—Ç–æ—Ä–∏—è -->
      <section id="historyPanel" class="spanel visible">
        <div class="row wrap gap">
          <button id="exportHistoryBtn" class="btn">–≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏</button>
          <button id="clearHistoryBtn" class="btn danger">–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
        </div>
        <ol id="historyList" class="history"></ol>
      </section>

      <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <section id="settingsPanel" class="spanel">
        <div class="field">
          <label for="hardnessRange">–£—Ä–æ–≤–µ–Ω—å ¬´–∂–µ—Å—Ç–∫–æ—Å—Ç–∏¬ª –±–∞–ª–∞–Ω—Å–∞ (–º–æ–Ω–µ—Ç—ã): <span id="hardnessLabel">1.0√ó</span></label>
          <input id="hardnessRange" type="range" min="0.5" max="3.0" step="0.1" value="1.0" />
          <p class="hint">–ú–Ω–æ–∂–∏—Ç–µ–ª—å –∫ –±—é–¥–∂–µ—Ç—É –∏ –º–æ–Ω–µ—Ç–∞–º (0.5√ó‚Ä¶3.0√ó). 1.0 ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.</p>
        </div>
        <div class="field">
          <label for="maxItemsInput">–ú–∞–∫—Å–∏–º—É–º –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∑–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é</label>
          <input id="maxItemsInput" type="number" min="1" max="3" value="1" />
        </div>
        <div class="row wrap gap">
          <button id="saveSettingsBtn" class="btn primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
          <button id="resetSettingsBtn" class="btn">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
      </section>
    </div>
  </aside>

  <footer class="app-footer">
    <small>¬© 2025 –õ–æ–∫–∞–ª—å–Ω—ã–π –æ—Ñ–ª–∞–π–Ω-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä. –í–∞–Ω–∏–ª—å–Ω—ã–π JS.</small>
  </footer>

  <!-- –í–ê–ñ–ù–û: –≤–µ—Ä—Å–∏—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å VERSION –≤ service-worker.js -->
  <script src="app.js?v=v2025-09-05-1" defer></script>

  <!-- –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è SW, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–¥—Ç—è–≥–∏–≤–∞–ª–∏—Å—å —Å—Ä–∞–∑—É -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js', { updateViaCache: 'none' })
          .then(reg => {
            // –µ—Å–ª–∏ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —É–∂–µ —Å–∫–∞—á–∞–Ω–∞ –∏ –∂–¥—ë—Ç ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å—Ä–∞–∑—É
            if (reg.waiting) reg.waiting.postMessage({ type: 'SKIP_WAITING' });

            // –∫–æ–≥–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è ‚Äî –Ω–µ –∂–¥—ë–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
            reg.addEventListener('updatefound', () => {
              const nw = reg.installing;
              nw?.addEventListener('statechange', () => {
                if (nw.state === 'installed' && navigator.serviceWorker.controller) {
                  nw.postMessage({ type: 'SKIP_WAITING' });
                }
              });
            });
          })
          .catch(console.error);
      });
    }
  </script>
</body>
</html>
